# 🏠 社会模拟器 - AI驱动的合租生活场景

<p align="center">
  <img src="https://img.shields.io/badge/Python-3.7+-blue.svg" alt="Python Version">
  <img src="https://img.shields.io/badge/AI-Google%20Gemini%202.5-orange.svg" alt="AI Model">
  <img src="https://img.shields.io/badge/License-Educational-green.svg" alt="License">
</p>

## 📝 项目简介

这是一个基于 **Google Gemini AI** 构建的**多智能体社会模拟系统**，通过4个具有独特性格的AI角色模拟真实的合租生活场景。不同于传统的预设脚本游戏，本项目让AI角色真正"活"起来——他们会自主思考、产生冲突、协商解决，最终涌现出无法预测的故事情节。

**核心特色：** 去中心化信息设计 + AI完全自主决策 + 环境感知系统 + 涌现式叙事

---

## 📑 目录

- [快速开始](#-快速开始)
- [安装](#-安装)
- [使用方法](#-使用方法)
- [项目结构](#-项目结构)
- [角色介绍](#-角色介绍)
- [核心功能](#-核心功能)
- [开发思路](#-开发思路)
- [技术架构](#-技术架构)
- [常见问题](#-常见问题)
- [贡献指南](#-贡献指南)
- [许可证](#-许可证)

---

## ⚡ 快速开始

```bash
# 1. 克隆项目
git clone https://github.com/your-username/shehui-copy.git
cd shehui-copy

# 2. 安装依赖
pip install -r requirements.txt

# 3. 配置API密钥
# 在 config.py 中设置你的 GEMINI_API_KEY

# 4. 运行模拟器
python app.py
```

**5秒了解项目：** 4个AI室友在虚拟合租房中自主生活，你作为观察者看他们如何互动、冲突、协商。

---

## 📦 安装

### 先决条件

- **Python 3.7+**
- **稳定的网络连接**（需要访问Google AI API）
- **Google AI API密钥**（[获取地址](https://aistudio.google.com/app/apikey)）

### 安装步骤

1. **克隆仓库**
   ```bash
   git clone https://github.com/your-username/shehui-copy.git
   cd shehui-copy
   ```

2. **安装Python依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置API密钥**
   
   编辑 `config.py` 文件，填入你的Google AI API密钥：
   ```python
   GEMINI_API_KEY = "你的API密钥"
   ```

---

## 🚀 使用方法

### 基础运行模式

**单次运行（无记忆）：**
```bash
python app.py
```
- 适合快速测试和演示
- 程序结束后记忆消失
- 运行20个时间步（模拟早上7:00到中午12:00）

### 分次运行模式（带记忆）

**第一次运行：**
```bash
python app_first.py
```
- 创建新对话并保存记忆到 `chat_history.json`
- AI角色会记住这次的所有互动

**第二次运行：**
```bash
python app_second.py
```
- 加载历史记忆，继续之前的故事
- AI完全记住之前的对话和经历

### 调整运行参数

在 `app.py` 中修改运行时长：
```python
game.run(num_ticks=20)  # 20个时间步 = 5小时（每步15分钟）
```

在 `config.py` 中调整时间间隔：
```python
TICK_INTERVAL = 5  # 每个时间步之间的间隔（秒）
```

---

## 📁 项目结构

```
shehui-copy/
├── 📄 app.py                      # 主程序入口（单次运行）
├── 📄 app_first.py                # 第一次运行（保存记忆）
├── 📄 app_second.py               # 第二次运行（加载记忆）
├── 📄 game_loop.py                # 游戏主循环控制器
├── 📄 npc_chracter.py             # NPC角色类（AI调用逻辑）
├── 📄 agent_system.py             # 智能体系统（审核协调）
├── 📄 resource_manager.py         # 资源管理器（已废弃）
├── 📄 config.py                   # 配置文件（API密钥等）
├── 📄 requirements.txt            # Python依赖列表
│
├── 📋 README.md                   # 项目说明（本文件）
├── 📋 DESIGN_DOC.md              # 详细设计文档
├── 📋 使用示例.md                 # 记忆功能使用示例
├── 📋 实现总结.md                 # 实现总结文档
├── 📋 版本对比说明.md             # 三版本对比说明
├── 📋 快速使用指南.txt            # 快速参考指南
│
├── 📝 小明-程序员-提示词.txt       # 小明的角色设定
├── 📝 小庄-设计师-提示词.txt       # 小庄的角色设定
├── 📝 小张-厨师-提示词.txt         # 小张的角色设定
├── 📝 小李-学生-提示词.txt         # 小李的角色设定
├── 📝 智能体-系统提示词.txt        # 智能体系统设定
│
└── 📊 chat_history.json           # 对话历史记录（自动生成）
```

### 核心模块说明

| 模块 | 职责 | 核心功能 |
|------|------|----------|
| **GameLoop** | 游戏主循环 | 控制时间流动、协调NPC轮流行动 |
| **NPCCharacter** | NPC角色 | AI调用、思考生成、行为输出 |
| **AgentSystem** | 智能体系统 | 生成环境感知、转发对话 |
| **Config** | 配置管理 | API密钥、NPC列表、资源设置 |

---

## 👥 角色介绍

### 合租室友（4个AI角色）

| 角色 | 职业 | 性格 | 特点 |
|------|------|------|------|
| 🧑‍💼 **小明** | 程序员 | 内向、技术宅 | 熬夜编程，深夜洗澡 |
| 👩‍🎨 **小庄** | 设计师 | 外向、爱美 | 早起化妆，注重品质 |
| 🧑‍🍳 **小张** | 厨师 | 热情、爱分享 | 早起做饭，作息规律 |
| 👨‍🎓 **小李** | 学生 | 安静、好学 | 准备论文，安静学习 |

### 智能体系统（环境感知生成器）

- **功能**：生成环境感知描述（声音、气味、视觉）
- **特点**：基于所有NPC的行为生成真实的环境反馈
- **职责**：
  - 生成环境感知信息
  - 转发NPC之间的对话
  - 维护环境的真实感

---

## 🎯 核心功能

### 1. 环境感知系统 🌍

每个NPC都会接收到环境感知信息：
- **听觉**：听到厨房的炒菜声、客厅的电视声
- **嗅觉**：闻到厨房传来的香味
- **视觉**：看到其他室友的活动

### 2. AI完全自主决策 🤖

- NPC不知道其他人在做什么
- 只能通过环境感知推测
- 完全自主思考和决策
- 每次运行产生不同结果

### 3. 记忆系统 🧠

使用Gemini Chat模式：
- NPC记住之前的所有对话
- 行为更加连贯和真实
- 可以跨多次运行保持记忆

### 4. 自然语言交互 💬

- NPC之间用自然语言对话
- 没有预设的对话树
- AI理解语义并做出反应

---

## 💡 开发思路

### 核心设计理念

1. **去中心化信息设计** - NPC不知道全局状态，只通过环境感知了解周围
2. **涌现式叙事** - 故事从角色互动中自然产生，而非预设剧本
3. **最小干预原则** - 系统只在必要时介入，让AI保持最大自主性

### 技术选型

- **AI模型**：Google Gemini 2.5 Flash（快速响应、支持长上下文）
- **编程语言**：Python 3.7+（简单易学、AI库丰富）
- **架构模式**：分层设计（游戏循环 → NPC → 智能体）

### 详细设计文档

本项目的详细设计理念、技术选型思考、实现步骤以及遇到的挑战，请参考：

📖 **[DESIGN_DOC.md](./DESIGN_DOC.md)** - 完整的设计文档

内容包括：
- 项目愿景与研究价值
- 技术架构详解
- 数据流转逻辑
- 提示词设计原理
- NPC与智能体交互流程
- 预期观察到的现象

---

## 🏗️ 技术架构

### 系统分层

```
观察层（用户）
    ↓ 只能观察，不能干预
游戏循环（GameLoop）
    ↓ 控制时间流动和调度
NPC层（4个AI角色）
    ↓ 自主思考和行动
智能体层（环境系统）
    ↓ 生成环境感知和转发对话
```

### 数据流转

```
1. GameLoop 启动时间步
    ↓
2. 遍历每个NPC，轮流行动
    ↓
3. NPC调用AI思考 → 生成想法和对话
    ↓
4. 智能体生成环境感知
    ↓
5. 分发环境感知和对话给相关NPC
    ↓
6. 时间推进15分钟
    ↓
7. 重复步骤2-6
```

### 环境感知生成流程

```
智能体收集所有NPC的行为
    ↓
分析每个NPC周围的环境
    ↓
生成个性化的感知描述
    ↓
    ├─→ 小明在客厅：听到厨房传来炒菜声
    ├─→ 小张在厨房：闻到自己做的早餐香味
    └─→ 小李在卧室：听到客厅电视的声音
```

---

## ❓ 常见问题

### 1. API密钥错误怎么办？

**错误信息**：`401 Unauthorized`

**解决方案**：
- 检查 `config.py` 中的 `GEMINI_API_KEY` 是否正确
- 前往 [Google AI Studio](https://aistudio.google.com/app/apikey) 获取新密钥

### 2. 程序运行很慢？

**原因**：为了避免超过API限制，代码中添加了8秒延迟

**解决方案**：
- 在 `game_loop.py` 第96行修改 `time.sleep(8)` 为更小的值
- 注意：可能会触发API限制

### 3. NPC行为不符合预期？

这是正常的！AI是完全自主决策的，每次运行都会产生不同结果。

### 4. 如何清空记忆重新开始？

```bash
rm chat_history.json
python app_first.py
```

### 5. 如何添加新的NPC？

1. 在 `config.py` 中添加NPC配置
2. 创建对应的提示词文件
3. GameLoop会自动识别

---

## 📊 运行示例

### 典型输出

```
============================================================
时间: 早上7:00 | Tick: 0
============================================================

[小明]
  想法: 早上7点了，昨晚又熬夜写代码到凌晨3点...
  🌍 环境感知: 你听到厨房传来炒菜的声音，闻到诱人的香味...

[小张]
  想法: 作为一个厨师，早起做早餐是我的习惯...
  对话: 对小明说「早啊！要不要来点我做的煎蛋？」
  🌍 环境感知: 你在厨房忙碌着，听到客厅传来电视的声音...

[等待API冷却...]
```

---

## 🤝 贡献指南

欢迎提交Issue和Pull Request！特别欢迎：

### 贡献方向

- ✨ **新角色设定** - 添加更多有趣的室友角色
- 🎭 **新场景** - 添加更多生活场景（比如周末聚会、深夜讨论等）
- 🔧 **功能优化** - 改进AI响应质量、减少API调用次数
- 📚 **文档改进** - 完善文档、添加更多示例
- 🐛 **Bug修复** - 发现并修复问题

### 如何贡献

1. Fork 这个仓库
2. 创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交你的修改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启一个 Pull Request

---

## 📄 许可证

本项目仅供**学习和研究使用**。

**注意事项**：
- ⚠️ 请遵守 Google AI API 的使用条款
- ⚠️ 项目模拟的场景仅供娱乐，不代表真实情况
- ⚠️ 请合理使用API配额，避免产生不必要的费用

---

## 🌟 致谢

- 感谢 [Google Gemini](https://ai.google.dev/) 提供强大的AI能力
- 感谢所有为这个项目提供建议和反馈的朋友

---

## 📮 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 📧 Email: your-email@example.com
- 💬 Issue: [提交Issue](https://github.com/your-username/shehui-copy/issues)

---

<p align="center">
  Made with ❤️ by [Your Name]
</p>

<p align="center">
  如果这个项目对你有帮助，请给它一个 ⭐️
</p>
